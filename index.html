<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex,nofollow">
<title>ğŸŸï¸ Rifa Solidaria â€“ Camada Cuki  (varios precios)</title>
<link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@700;900&display=swap" rel="stylesheet">

<style>
:root{
  --green:#2c3e76;        /* banda/tÃ­tulos */
  --green-2:#3d4f9f;      /* hover */
  --peach:#f7f9ff;        /* texto en tÃ­tulos */
  --peach-2:#eef1ff;      /* cards */
  --bg1:#d6e4ff;          /* fondo */
  --ink:#0d1333;          /* texto principal */
  --border:#c4cff5;       /* bordes suaves */
  --sold:#f2f4fb;         /* reservado/pago */
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(120deg,var(--peach),var(--bg1));
  color:var(--ink);
}
.wrap{max-width:1100px;margin:28px auto;padding:16px}

/* Tarjetas */
.card{
  background:var(--peach-2);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  box-shadow:0 10px 30px rgba(44,62,118,.12);
}

/* TÃ­tulo estilo â€œGREENâ€ */
.title-green{
  font-family:'League Spartan',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  text-transform:uppercase; font-weight:900; letter-spacing:.5px;
  color:var(--peach); background:var(--green);
  padding:10px 14px; border-radius:14px; display:inline-block;
}

/* Cabecera */
.hero{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.sub{color:#1f1f1f;font-weight:600}

/* Leyenda */
.legend{display:flex;gap:12px;align-items:center;color:#1f275c;font-size:.95rem;margin-top:8px;flex-wrap:wrap}
.legend .chip{width:14px;height:14px;border-radius:4px;display:inline-block;background:#fff;border:1px solid var(--border)}
.legend .chip.sel{background:#e4e8ff;border-color:var(--green)}
.legend .chip.sold{background:var(--sold)}

/* Grilla */
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:12px;margin-top:10px}
.num{
  text-align:center;padding:12px 6px;border-radius:12px;border:1px solid var(--border);
  background:#fff;font-weight:800;user-select:none;cursor:pointer;
  transition:.12s ease;box-shadow:0 2px 0 rgba(0,0,0,.04);
  font-size:clamp(14px,3.2vw,18px);line-height:1;letter-spacing:.5px;
}
.num:hover{transform:translateY(-1px);border-color:var(--green-2)}
.num.sel{
  background:var(--green); color:#fff; border-color:var(--green);
  box-shadow:0 0 0 2px rgba(44,62,118,.18) inset;
}
.num.sold{background:var(--sold);color:#9a9a9a;text-decoration:line-through;cursor:not-allowed}

/* Acciones */
.sum{margin-top:8px;font-weight:800;color:#1f275c}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.btn{
  all:unset;cursor:pointer;padding:10px 14px;border-radius:10px;font-weight:800;
  border:1px solid var(--border);background:linear-gradient(180deg,#e4e9ff,#ccd7ff);
  color:#1f275c;box-shadow:0 1px 0 rgba(0,0,0,.04)
}
.btn:disabled{opacity:.45;cursor:not-allowed}
.btn.secondary{background:#fff;color:#1f275c}
.status{font-size:.9rem;color:#1f275c}

/* Responsive columnas */
@media (max-width:900px){ .grid{grid-template-columns:repeat(8,1fr)} }
@media (max-width:640px){ .grid{grid-template-columns:repeat(6,1fr)} }
@media (max-width:420px){ .grid{grid-template-columns:repeat(5,1fr)} }

  /* Premios & Pago */
  .prizes li{margin:6px 0}
  .paygrid{display:grid;grid-template-columns:1fr;gap:6px;margin:10px 0 0}
  .paygrid b{display:block;color:var(--dark)}
  .qr{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:10px}
  .qr img{width:160px;height:160px;border-radius:12px;border:1px solid var(--border);background:#fff}

  /* responsive */
  @media (max-width:900px){ .grid{grid-template-columns:repeat(8,1fr)} }
  @media (max-width:640px){ .grid{grid-template-columns:repeat(6,1fr)} .num{padding:10px 4px} }
  @media (max-width:420px){ .grid{grid-template-columns:repeat(5,1fr)} .num{padding:10px 2px;font-size:clamp(12px,4vw,16px)} }
</style>
</head>
<body>
<div class="wrap">

  <!-- Encabezado -->
  <div class="card hero">
    <div>
      <h1>ğŸŸï¸ SÃºper rifa Camada Cuki â€“ (Varios Premios)</h1>
      <div class="sub">ElegÃ­ hasta 4 nÃºmeros y escribime por WhatsApp ğŸ’¬</div>
      <div class="pills" style="margin-top:6px">
        <span>$10.000 c/u</span><span>2 Ã— $18.000</span><span>3 Ã— $26.000</span>
      </div>
      <div id="st" class="status">Estado: conectandoâ€¦</div>
    </div>
  </div>

  <!-- Premios -->
  <div class="card" style="margin-top:12px;">
    <h3>ğŸ†Beneficios: Premios</h3>
    <ul class="prizes">
      <li><b>1.Âº Premio:</b>2 Entradas <b>Instagram</b> <a href="https://www.instagram.com/mariabecerra/" target="_blank" rel="noopener">@mariabecerra</a>(campo centenario) Beneficios: Early entrance.Kit de merch exclusivo.Credencial conmemorativa.</li>
      <li><b>2.Âº Premio:</b> Perfumes (combo)
  Latafa Yara Candy Â· Latafa Asad Â· Calvin Klein Be.</li>
      <li><b>3.Âº Premio:</b> Make up / Skin care (Kit A)</b><br>
  Nivea toallita desmaquillante, Meraki hisopos, Conni pad limpieza, 
  ACF Protector camuflaje, Serum humectante Vol 1Â° ACF, MÃ¡scara Maybelline Falsies Lash,
  Corrector Maybelline Eraser, DÃºo sombras Extrime, Carmex, Gel de cejas Extrime, 
  Delineador de labios, Labial MAC, Paleta rostro Avon, Esponja Get the look.</li>
      <li><b>4.Âº Premio:</b> Make up / Skin care (Kit B)</b><br>
  BÃ¡lsamo desmaquillante TDM, ACF barra protectora, Clinique gel limpieza, Pad Coony, Hisopos Meraki, Carmex,
  Gel de ceja Lâ€™OrÃ©al, MÃ¡scara Maybelline, Corrector Maybelline, Sombra en barra Extrime, Delineador de labios Extrime,
  Iluminador Avon, Gloss Extrime, Esponja Coony. </li>
      <li><b>5.Âº Premio:</b> Hair & Body / Accesorios (Kit C)</b><br>
  Pad Coony, Hisopos Meraki, EspÃ¡tula Coony mascarilla, Mascara Maybelline, Sombra en barra, 
  Gel delineador, Labial TDM, Mascara de Labios TDM, Protector tÃ©rmico Primark,
  Sellador Pantene, Dove Serum</li>
<li><b>6.Âº Premio:</b> Combo Victoriaâ€™s Secret<br><span style="opacity:.85">Body Splash y Crema</span></li>

    </ul>
    <small class="sub">*Modalidad abajo.</small>
  </div>

  <!-- SelecciÃ³n -->
  <div class="card" style="margin-top:12px;">
    <div class="label dark">SelecciÃ³n de nÃºmeros</div>

<div class="legend" style="margin-top:10px;">
  <span class="chip"></span> Disponible
  <span class="chip sel"></span> Seleccionado
  <span class="chip sold"></span> Reservado/PAGO
</div>


    <div id="grid" class="grid"></div>
    <div id="summary" class="sum">Seleccionados: â€”</div>

    <div class="actions">
      <button id="confirm" class="btn primary" disabled>Confirmar por WhatsApp</button>
      <button id="clear" class="btn secondary">Limpiar selecciÃ³n de nÃºmeros</button>
    </div>
  </div>

  <!-- Bases -->
  <div class="card" style="margin-top:12px;">
    <h3>ğŸ“ Bases & Condiciones</h3>
   <!-- BASES & CONDICIONES (copiar/pegar tal cual en tu pÃ¡gina) -->
<div class="card bases" style="margin-top:12px;">
    <li><b>Cantidad de nÃºmeros:</b> del <b>001</b> al <b>500</b>.</li>
    <li><b>CÃ³mo participar:</b> elegÃ­s nÃºmero(s) disponible(s) en la web y escribÃ­s por WhatsApp para confirmar.
      El/los nÃºmero(s) quedan en estado â€œReservadoâ€ hasta acreditar el pago.</li>
    <li><b>Reservas:</b> la reserva automÃ¡tica dura <b>15 minutos</b>. Vencido ese plazo sin PAGO, los nÃºmeros vuelven a estar disponibles.</li>
    <li><b>Sorteo pÃºblico:</b> se define con la <b>Quiniela Nocturna CABA</b> de la fecha (?). Se usan las posiciones del <b>1.Âº al 6.Âº premio</b> para asignar los 6 premios de esta rifa en ese mismo orden.</li>
    <li><b>DeterminaciÃ³n de ganadores (regla tÃ©cnica):</b>
      <ol>
        <li>De cada posiciÃ³n del extracto (1.Âº, 2.Âº, â€¦) se toman las <b>Ãºltimas 3 cifras</b> (valor 000â€“999).</li>
        <li>Se mapea al rango 001â€“500 con: <code>n = (xxx % 500) + 1</code>
          <div style="opacity:.9;margin-top:4px">
            Ejemplos: 824 â†’ 325 Â· 592 â†’ 93 Â· 318 â†’ 319 Â· 542 â†’ 43 Â· 755 â†’ 256 Â· 770 â†’ 271 Â· 000 â†’ 500 Â· 999 â†’ 500
          </div>
        </li>
        <li><b>Sin repetidos:</b> si un nÃºmero ya resultÃ³ ganador, se usa la <b>siguiente posiciÃ³n</b> del extracto (7.Âº, 8.Âº, â€¦) hasta completar 6 ganadores Ãºnicos.</li>
        <li><b>NÃºmero no vendido (si aplica):</b> si el nÃºmero obtenido no estÃ¡ vendido, el premio <b>corre hacia abajo</b> (ej.: 353 â†’ 352 â†’ 351 â†’ â€¦) hasta encontrar un nÃºmero vendido.</li>
      </ol>
    </li>
    <li><b>Premios:</b> se publican listados (Premio 1 â†’ 1.Âº ganador, Premio 2 â†’ 2.Âº ganador, â€¦). No son canjeables por dinero. Si algÃºn premio estuviera discontinuado/agotado, podrÃ¡ reemplazarse por otro de <b>igual o mayor valor</b>.</li>
    <li><b>PublicaciÃ³n y entrega:</b> se publican ganadores/as en Instagram y WhatsApp dentro de las <b>24 h</b>. Para validar, se solicita comprobante de pago y datos del/los nÃºmero(s).
      <b>Entrega:</b> en mano en <i>Palmas del Pilar, Tortugas Open Mall, El Solar Shopping</i> o envÃ­o a cargo del/la ganador/a (a coordinar).
    </li>
    <li><b>Plazo para reclamar:</b> <b>7 dÃ­as corridos</b> desde la publicaciÃ³n. Pasado ese plazo, el premio se considera <b>desierto</b>.</li>
    <li><b>Devoluciones:</b> no aplican una vez acreditado el pago.</li>
    <li><b>Transparencia:</b> se conservarÃ¡n capturas del extracto de Quiniela y del procedimiento de asignaciÃ³n. La participaciÃ³n implica la <b>aceptaciÃ³n total</b> de estas bases.</li>
    <li><b>Aviso legal:</b> esta promociÃ³n <b>no estÃ¡ patrocinada, avalada ni administrada</b> por Meta, Instagram o WhatsApp, ni asociada a ellos.</li>
  </ul>
</div>

  </div>

  <!-- Contacto & Medios de pago -->
  <div class="card" style="margin-top:12px;">
    <h3>ğŸ“² Contacto & Medios de pago</h3>

    <div class="paygrid">
      <div><b>Medio de pago Ãºnico</b> Transferencia</div>
      <div><b>Cuenta</b> de Mercado Pago</div>
      <div><b>Titular</b> Francesca Lisanti</div>
      <div><b>CUIT/CUIL</b> 27-40388809-0</div>
      <div><b>CVU</b> 0000003100061623575458</div>
      <div><b>Alias</b> cukirescatados</div>
    </div>
    <div><b>Instagram</b> <a href="https://instagram.com/mariangelaramirezz" target="_blank" rel="noopener">@mariangelaramirezz</a></div>

    <div class="qr">
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https%3A%2F%2Fwa.me%2F5491133328404" alt="QR WhatsApp">
      <a class="btn" href="https://wa.me/5491133328404" target="_blank" rel="noopener">Abrir WhatsApp</a>
    </div>
  </div>

</div>

<script>
  /* ========= CONFIG ========= */
  const API_BASE   = "https://script.google.com/macros/s/AKfycbzovYKCa6Xc2OdEjGxAgmskybWSaCDdAgBfksRYlIMI1fdftp6oV4jRdx0ECMzyAfaT/exec"; // â† pegÃ¡ tu /exec
  const WHATS      = "5491133328404";
  const MAX_SELECT = 4;
  const PRICES     = {1:10000, 2:18000, 3:26000};
  const CVU        = "0000003100061623575458";
  const ALIAS      = "cukirescatados";

  const MAX_N = 500; // ğŸ‘ˆ 500 nÃºmeros

  const grid      = document.getElementById('grid');
  const summary   = document.getElementById('summary');
  const btnConfirm= document.getElementById('confirm');
  const btnClear  = document.getElementById('clear');
  const st        = document.getElementById('st');

  let selected = new Set();
  let taken    = new Set();
  const inflight = new Set(); // nÃºmeros con peticiÃ³n en curso

  const clientId = (() => {
    const k = 'raffleClientId';
    let v = localStorage.getItem(k);
    if(!v){ v = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+Math.random()); localStorage.setItem(k,v); }
    return v;
  })();

  const fmt   = n => n.toString().padStart(3,'0');
  const pesos = n => n.toLocaleString('es-AR');

  function bestPrice(k){
    const tiers = Object.keys(PRICES).map(Number).sort((a,b)=>a-b);
    const dp = Array(k+1).fill(Infinity); dp[0]=0;
    for(let i=1;i<=k;i++){ for(const t of tiers){ if(t<=i) dp[i]=Math.min(dp[i],dp[i-t]+PRICES[t]); } }
    return dp[k] || 0;
  }

  function renderGridBase(){
    const frag = document.createDocumentFragment();
    for(let i=1;i<=MAX_N;i++){
      const d = document.createElement('div');
      d.className = 'num';
      d.textContent = fmt(i);
      d.addEventListener('click', () => handleToggle(i, d));
      frag.appendChild(d);
    }
    grid.innerHTML = '';
    grid.appendChild(frag);
  }

  function applyTaken(){
    for(let i=1;i<=MAX_N;i++){
      const el = grid.children[i-1];
      if(!el) continue;
      if(taken.has(i)){
        el.classList.add('sold');
        el.replaceWith(el.cloneNode(true)); // quita listeners si ya estÃ¡ vendido
      }else{
        el.classList.remove('sold');
      }
    }
  }

  function repaintSelections(){
    document.querySelectorAll('.num.sel').forEach(el=>el.classList.remove('sel'));
    for(const n of selected){
      const el = grid.children[n-1];
      if(el && !el.classList.contains('sold')) el.classList.add('sel');
    }
  }

  function updateSummary(){
    const arr = [...selected].sort((a,b)=>a-b).map(fmt);
    const k = arr.length, total = k ? bestPrice(k) : 0;
    summary.textContent = k
      ? `Seleccionados: ${arr.join(', ')} â€¢ Total a pagar: $${pesos(total)}`
      : 'Seleccionados: â€”';
    btnConfirm.disabled = (k===0);
  }

  async function apiGet(params){
    const q = new URLSearchParams(params).toString();
    const url = API_BASE + (API_BASE.includes('?') ? '&' : '?') + q;
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) throw new Error('GET '+r.status);
    return r.json();
  }
  async function apiPost(params){
    const r = await fetch(API_BASE, {
      method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:new URLSearchParams(params)
    });
    if(!r.ok) throw new Error('POST '+r.status);
    return r.json();
  }

  function handleToggle(n, el){
    if (inflight.has(n) || el.classList.contains('sold')) return;

    if (selected.has(n)){
      selected.delete(n);
      el.classList.remove('sel');
      updateSummary();
      inflight.add(n);
      apiPost({action:'release', clientId, ns:String(n)})
        .finally(()=>inflight.delete(n));
      return;
    }

    if (selected.size >= MAX_SELECT){
      pulse(summary);
      return;
    }

    selected.add(n);
    el.classList.add('sel');
    updateSummary();

    inflight.add(n);
    apiPost({action:'hold', clientId, ns:String(n)})
      .then(res=>{
        if (!(res.ok && res.ok.includes(n))){
          selected.delete(n);
          el.classList.remove('sel');
          taken.add(n);
          el.classList.add('sold');
          updateSummary();
          st.textContent = "Ese nÃºmero se reservÃ³ reciÃ©n. ElegÃ­ otro.";
        }
      })
      .catch(()=>{ /* si falla red, el hold expira por TTL */ })
      .finally(()=>inflight.delete(n));
  }

  function pulse(el){
    el.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:300});
  }

  function waLink(){
    const arr = [...selected].sort((a,b)=>a-b).map(fmt);
    const total = bestPrice(arr.length);
    const msg = `Hola Mar! Quiero participar con el/los nÃºmero(s): ${arr.join(', ')}.
Total a pagar: $${pesos(total)}.

CVU: ${CVU}
Alias: ${ALIAS}
Te envÃ­o el comprobante ahora.`;
    return "https://wa.me/"+WHATS+"?text="+encodeURIComponent(msg);
  }

  btnConfirm.addEventListener('click', async ()=>{
    if(selected.size===0) return;
    const ns = [...selected].join(',');
    const link = waLink();

    btnConfirm.disabled = true;
    st.textContent = 'Confirmandoâ€¦';

    const fallback = setTimeout(()=>{ window.location.href = link; }, 1200);
    try{
      const res = await apiPost({action:'finalize', clientId, ns});
      clearTimeout(fallback);
      if(res.lost && res.lost.length){
        for(const n of res.lost){ taken.add(Number(n)); selected.delete(Number(n)); }
        applyTaken(); repaintSelections(); updateSummary();
        st.textContent = 'Algunos nÃºmeros se agotaron. ElegÃ­ otros.';
        btnConfirm.disabled = false;
        return;
      }
      window.location.href = link;
    }catch(e){
      window.location.href = link;
    }
  });

  btnClear.addEventListener('click', async ()=>{
    const ns = [...selected].join(',');
    selected.clear(); repaintSelections(); updateSummary();
    if(ns){ try{ await apiPost({action:'release', clientId, ns}); }catch(_){ } }
  });

  async function refreshState(){
    try{
      const res = await apiGet({action:'state'});
      taken = new Set([...(res.sold||[]), ...(res.reserved||[])]);
      applyTaken(); repaintSelections(); updateSummary();
      st.textContent = 'Estado: conectado âœ“';
    }catch(e){
      st.textContent = 'Estado: sin conexiÃ³n';
    }
  }

  // Inicio
  renderGridBase();
  refreshState();
  setInterval(refreshState, 15000);
</script>
</body>
</html>
